<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Viewer Art Display</title>

  <!-- Firebase Compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>

  <style>
    body {
      background: #111;
      color: #eee;
      font-family: Arial, sans-serif;
      margin: 0; padding: 1rem;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      text-align: center;
      margin-bottom: 0.5rem;
    }
    #controls {
      margin-bottom: 1rem;
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
    }
    #art-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 12px;
      width: 100%;
      max-width: 900px;
    }
    #art-grid.streamer {
      display: flex;
      overflow-x: auto;
      gap: 10px;
    }
    #art-grid img {
      width: 100%;
      height: auto;
      border-radius: 8px;
      object-fit: cover;
      box-shadow: 0 0 6px #0ff;
      transition: transform 0.3s;
      flex-shrink: 0;
      max-width: 150px;
    }
    #art-grid img:hover {
      transform: scale(1.05);
    }
    #upload-form {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
      width: 100%;
      max-width: 900px;
      margin-bottom: 1rem;
    }
    #upload-form input[type="file"] {
      color: #eee;
    }
    #upload-form button {
      background-color: #0ff;
      border: none;
      padding: 0.5rem 1rem;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
      color: #111;
      transition: background-color 0.3s;
    }
    #upload-form button:hover {
      background-color: #0cc;
    }
    label {
      font-size: 0.9rem;
      user-select: none;
    }
    #max-artworks {
      width: 60px;
      padding: 0.3rem;
      border-radius: 6px;
      border: none;
      text-align: center;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <h1>Viewer Art Display</h1>

  <div id="controls">
    <label>
      Max images:
      <input type="number" id="max-artworks" min="1" max="20" value="5" />
    </label>

    <label>
      <input type="checkbox" id="streamer-mode" />
      Streamer Mode (OBS overlay)
    </label>
  </div>

  <form id="upload-form">
    <input type="file" id="artfile" accept="image/*" required />
    <button type="submit">Upload Artwork</button>
  </form>

  <div id="art-grid">Loading...</div>

  <script>
    // Your Firebase config here (replace with your own)
    const firebaseConfig = {
  apiKey: "AIzaSyDAyO1T8DBNx4dvVZ7vD0rJM1TXcbn4yPE",
  authDomain: "viewer-art-display.firebaseapp.com",
  projectId: "viewer-art-display",
  storageBucket: "viewer-art-display.firebasestorage.app",
  messagingSenderId: "612502835850",
  appId: "1:612502835850:web:4daf4f4440e78fe933d373",
  measurementId: "G-D9FJC0PFEC"
};

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const storage = firebase.storage();

    const artGrid = document.getElementById('art-grid');
    const maxArtworksInput = document.getElementById('max-artworks');
    const streamerModeCheckbox = document.getElementById('streamer-mode');
    const uploadForm = document.getElementById('upload-form');
    const artFileInput = document.getElementById('artfile');

    let maxArtworks = parseInt(maxArtworksInput.value, 10);
    let streamerMode = streamerModeCheckbox.checked;

    maxArtworksInput.addEventListener('change', () => {
      maxArtworks = parseInt(maxArtworksInput.value, 10);
      fetchAndDisplayArt();
    });

    streamerModeCheckbox.addEventListener('change', () => {
      streamerMode = streamerModeCheckbox.checked;
      updateDisplayMode();
    });

    function updateDisplayMode() {
      if (streamerMode) {
        artGrid.classList.add('streamer');
      } else {
        artGrid.classList.remove('streamer');
      }
    }

    async function fetchAndDisplayArt() {
      try {
        // Get artworks from Firestore collection 'artworks'
        const snapshot = await db.collection('artworks').orderBy('timestamp', 'desc').limit(maxArtworks).get();
        if (snapshot.empty) {
          artGrid.innerHTML = 'No artworks yet.';
          return;
        }

        artGrid.innerHTML = '';
        snapshot.forEach(doc => {
          const art = doc.data();
          const img = document.createElement('img');
          img.src = art.url;
          img.alt = art.title || 'Viewer Art';
          artGrid.appendChild(img);
        });
      } catch (e) {
        artGrid.innerHTML = 'Failed to load artworks.';
        console.error(e);
      }
    }

    // Initial load
    fetchAndDisplayArt();
    updateDisplayMode();

    // Refresh periodically
    setInterval(fetchAndDisplayArt, 10000);

    // Upload logic
    uploadForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const file = artFileInput.files[0];
      if (!file) return alert("Please select an image to upload.");

      const storageRef = storage.ref();
      const fileRef = storageRef.child('artworks/' + Date.now() + '_' + file.name);

      try {
        await fileRef.put(file);
        const url = await fileRef.getDownloadURL();

        // Add metadata to Firestore
        await db.collection('artworks').add({
          url,
          title: file.name,
          timestamp: firebase.firestore.FieldValue.serverTimestamp()
        });

        alert("Upload successful!");
        artFileInput.value = '';
        fetchAndDisplayArt();
      } catch (error) {
        console.error("Upload failed:", error);
        alert("Upload failed. See console for details.");
      }
    });
  </script>
</body>
</html>
